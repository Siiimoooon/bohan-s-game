<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badminton Tactics - 8 Birdies</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Teko:wght@500;700&family=Noto+Sans+TC:wght@500;900&display=swap');
        
        body { 
            background-color: #0f172a; 
            font-family: 'Noto Sans TC', sans-serif; 
            color: #f8fafc; 
            overflow: hidden; 
        }

        .court-bg {
            background-color: #1a4d2e; /* ç¶“å…¸ç¾½çƒå ´ç¶  */
            background-image: 
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        canvas { 
            image-rendering: auto; 
            max-width: 100%; 
            height: auto; 
            cursor: pointer; 
            box-shadow: 0 0 40px rgba(74, 222, 128, 0.3); 
            border: 8px solid #f8fafc;
            border-radius: 4px;
        }

        .btn-action { 
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%); 
            @apply text-white font-bold py-3 rounded-lg transition-all hover:brightness-110 active:scale-95 shadow-lg uppercase tracking-wider; 
        }

        .btn-secondary { 
            background: #334155; 
            @apply text-slate-200 font-bold py-3 rounded-lg border border-slate-500/30 transition-all hover:bg-slate-700; 
        }

        .stat-card {
            background: #1e293b;
            border-bottom: 4px solid #4ade80;
            @apply px-4 py-2 rounded-t-lg;
        }

        .sport-font { font-family: 'Teko', sans-serif; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="max-w-md w-full bg-[#0f172a] p-6 rounded-xl shadow-2xl border border-slate-700 relative">
        <!-- è£é£¾ç‡ˆå…‰ -->
        <div class="absolute -top-10 -left-10 w-40 h-40 bg-green-500/10 rounded-full blur-[60px]"></div>

        <div class="mb-6 text-center">
            <h1 class="text-4xl font-black italic tracking-widest text-green-400 sport-font">
                BADMINTON TACTICS
            </h1>
            <!-- æ ¹æ“šç”¨æˆ¶è¦æ±‚ä¿®æ”¹ç°¡ä»‹ -->
            <p class="text-xs text-slate-400 mt-1 font-bold">ç‚ºä»€éº¼æŸç¿°è¦è²·é€™å€‹å¯æ€•çš„ç©å…·</p>
        </div>

        <div class="relative flex justify-center mb-6">
            <canvas id="gameCanvas" width="300" height="300" class="court-bg"></canvas>
            
            <!-- å‹åˆ©è¦†è“‹å±¤ -->
            <div id="victoryOverlay" class="absolute inset-0 bg-slate-900/90 flex items-center justify-center hidden z-30">
                <div class="text-center p-6 border-2 border-green-500 rounded-lg">
                    <div class="text-6xl mb-2">ğŸ†</div>
                    <div class="text-2xl font-black text-green-400 italic">å®Œæˆè¨“ç·´ï¼</div>
                    <p class="text-slate-400 text-sm mt-2 mb-6">å®Œç¾æŒæ§å…¨å ´</p>
                    <button onclick="resetGame()" class="px-8 py-2 btn-action w-full">å†æ¬¡æŒ‘æˆ°</button>
                </div>
            </div>
        </div>

        <!-- æ•¸æ“šé¢æ¿ -->
        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="stat-card">
                <span class="text-slate-500 text-[10px] block uppercase font-bold">Accuracy</span>
                <span id="progressText" class="text-green-400 font-bold text-2xl sport-font tracking-widest">0/8</span>
            </div>
            <div class="stat-card">
                <span class="text-slate-500 text-[10px] block uppercase font-bold">Stamina (Moves)</span>
                <span id="stepText" class="text-white font-bold text-2xl sport-font tracking-widest">0</span>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6">
            <button onclick="undoMove()" class="btn-secondary text-xs">æ’¤éŠ·æ­¥æ•¸ (U)</button>
            <button onclick="resetGame()" class="btn-secondary text-xs">é‡æ–°é–‹å§‹ (R)</button>
        </div>

        <!-- æ‰‹æ©Ÿæ§åˆ¶ -->
        <div class="grid grid-cols-3 gap-2 w-36 mx-auto opacity-80">
            <button class="col-start-2 h-12 bg-slate-700 rounded-lg flex items-center justify-center text-white" onclick="handleMove(0, -1)">â–²</button>
            <button class="col-start-1 h-12 bg-slate-700 rounded-lg flex items-center justify-center text-white" onclick="handleMove(-1, 0)">â—€</button>
            <button class="col-start-2 h-12 bg-slate-700 rounded-lg flex items-center justify-center text-white" onclick="handleMove(0, 1)">â–¼</button>
            <button class="col-start-3 h-12 bg-slate-700 rounded-lg flex items-center justify-center text-white" onclick="handleMove(1, 0)">â–¶</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const victoryOverlay = document.getElementById('victoryOverlay');
        
        const ROWS = 5; 
        const COLS = 5; 
        const TILE_SIZE = 60;

        // åœ°åœ–ï¼š2=ç¾½çƒè½é»(ç›®æ¨™)
        let staticMap = [
            [2, 0, 2, 0, 2],
            [0, 0, 0, 0, 0],
            [2, 0, 0, 0, 2],
            [0, 0, 0, 0, 0],
            [2, 0, 2, 0, 2]
        ];

        let startState = {
            player: { r: 2, c: 2 },
            boxes: [
                { r: 1, c: 1 }, { r: 1, c: 2 }, { r: 1, c: 3 },
                { r: 2, c: 1 },                 { r: 2, c: 3 },
                { r: 3, c: 1 }, { r: 3, c: 2 }, { r: 3, c: 3 }
            ]
        };

        let gameState = { ...JSON.parse(JSON.stringify(startState)), steps: 0 };
        let history = [];

        // ç¹ªè£½ç¾½çƒæ‹ (ç©å®¶)
        function drawPlayer(x, y) {
            ctx.save();
            ctx.translate(x + TILE_SIZE/2, y + TILE_SIZE/2);
            
            // ç¹ªè£½æ‰‹æŸ„
            ctx.strokeStyle = '#fca5a5';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(15, 15);
            ctx.stroke();

            // ç¹ªè£½çƒæ‹æ¡†
            ctx.strokeStyle = '#f8fafc';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.ellipse(-5, -5, 12, 14, Math.PI/4, 0, Math.PI*2);
            ctx.stroke();

            // ç¹ªè£½ç¶²æ ¼ (ç°¡ç•¥)
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(-10, -5); ctx.lineTo(2, 8);
            ctx.moveTo(-5, -10); ctx.lineTo(8, 2);
            ctx.stroke();

            ctx.restore();
        }

        // ç¹ªè£½ç¾½çƒ (ç®±å­)
        function drawBirdie(x, y, onTarget) {
            ctx.save();
            ctx.translate(x + TILE_SIZE/2, y + TILE_SIZE/2);
            
            // å½±å­
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(0, 15, 10, 5, 0, 0, Math.PI*2);
            ctx.fill();

            // ç¾½æ¯›éƒ¨åˆ†
            ctx.fillStyle = onTarget ? '#4ade80' : '#f1f5f9';
            ctx.beginPath();
            ctx.moveTo(0, 10);
            ctx.lineTo(-12, -10);
            ctx.lineTo(12, -10);
            ctx.closePath();
            ctx.fill();

            // çƒé ­ (è»Ÿæœ¨)
            ctx.fillStyle = onTarget ? '#16a34a' : '#ef4444';
            ctx.beginPath();
            ctx.arc(0, 10, 6, 0, Math.PI*2);
            ctx.fill();

            ctx.restore();
        }

        // ç¹ªè£½ç›®æ¨™é» (è½é»)
        function drawTarget(x, y) {
            const padding = 10;
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.setLineDash([]);
            
            // ç¹ªè£½å ´åœ°è½é»æ¨™è¨˜ [ ]
            const size = 15;
            const cx = x + TILE_SIZE/2;
            const cy = y + TILE_SIZE/2;

            ctx.beginPath();
            // å·¦ä¸Š
            ctx.moveTo(cx - size, cy - size + 5); ctx.lineTo(cx - size, cy - size); ctx.lineTo(cx - size + 5, cy - size);
            // å³ä¸Š
            ctx.moveTo(cx + size, cy - size + 5); ctx.lineTo(cx + size, cy - size); ctx.lineTo(cx + size - 5, cy - size);
            // å·¦ä¸‹
            ctx.moveTo(cx - size, cy + size - 5); ctx.lineTo(cx - size, cy + size); ctx.lineTo(cx - size + 5, cy + size);
            // å³ä¸‹
            ctx.moveTo(cx + size, cy + size - 5); ctx.lineTo(cx + size, cy + size); ctx.lineTo(cx + size - 5, cy + size);
            ctx.stroke();

            // ä¸­å¿ƒå¾®å…‰
            ctx.fillStyle = 'rgba(74, 222, 128, 0.1)';
            ctx.beginPath();
            ctx.arc(cx, cy, 10, 0, Math.PI*2);
            ctx.fill();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç¹ªè£½å ´åœ°é‚Šç·š
            ctx.strokeStyle = 'rgba(255,255,255,0.8)';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, canvas.width, canvas.height);

            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const x = c * TILE_SIZE, y = r * TILE_SIZE;
                    if (staticMap[r][c] === 2) {
                        drawTarget(x, y);
                    } else {
                        ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                        ctx.strokeRect(x, y, TILE_SIZE, TILE_SIZE);
                    }
                }
            }

            let correct = 0;
            gameState.boxes.forEach(box => {
                const onTarget = staticMap[box.r][box.c] === 2;
                if (onTarget) correct++;
                drawBirdie(box.c*TILE_SIZE, box.r*TILE_SIZE, onTarget);
            });

            drawPlayer(gameState.player.c*TILE_SIZE, gameState.player.r*TILE_SIZE);
            
            document.getElementById('progressText').innerText = `${correct}/8`;
            document.getElementById('stepText').innerText = gameState.steps;
            
            if (correct === 8) {
                victoryOverlay.classList.remove('hidden');
            }
        }

        function executeMove(dc, dr) {
            const nr = gameState.player.r + dr, nc = gameState.player.c + dc;
            if (nr < 0 || nr >= ROWS || nc < 0 || nc >= COLS) return false;
            
            const bIdx = gameState.boxes.findIndex(b => b.r === nr && b.c === nc);
            if (bIdx !== -1) {
                const bnr = nr + dr, bnc = nc + dc;
                if (bnr < 0 || bnr >= ROWS || bnc < 0 || bnc >= COLS || gameState.boxes.some(b => b.r === bnr && b.c === bnc)) return false;
                history.push(JSON.stringify(gameState));
                gameState.boxes[bIdx].r = bnr; 
                gameState.boxes[bIdx].c = bnc;
            } else { 
                history.push(JSON.stringify(gameState)); 
            }
            
            gameState.player.r = nr; 
            gameState.player.c = nc; 
            gameState.steps++;
            draw(); 
            return true;
        }

        function handleMove(dc, dr) { executeMove(dc, dr); }
        function undoMove() { 
            if (history.length > 0) { 
                gameState = JSON.parse(history.pop()); 
                draw(); 
            } 
        }
        function resetGame() { 
            gameState = JSON.parse(JSON.stringify(startState)); 
            gameState.steps = 0; 
            history = []; 
            victoryOverlay.classList.add('hidden'); 
            draw(); 
        }

        window.onload = draw;
        
        window.addEventListener('keydown', (e) => {
            if (e.key === 'r' || e.key === 'R') resetGame();
            if (e.key === 'u' || e.key === 'U') undoMove();
            const m = { 
                ArrowUp:[0,-1], w:[0,-1], W:[0,-1],
                ArrowDown:[0,1], s:[0,1], S:[0,1],
                ArrowLeft:[-1,0], a:[-1,0], A:[-1,0],
                ArrowRight:[1,0], d:[1,0], D:[1,0]
            };
            if (m[e.key]) {
                e.preventDefault();
                handleMove(...m[e.key]);
            }
        });
    </script>
</body>
</html>
